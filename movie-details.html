<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details - MyFlex</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #000; color: #fff; }
        .backdrop {
            background-size: cover; background-position: center;
            filter: blur(8px) brightness(0.4); position: absolute;
            top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }
        .movie-poster { border-radius: 12px; max-width: 300px; width: 100%; }
        .info-title { color: #ff4444; border-bottom: 2px solid #ff4444; }
        .cast-list span { background: #222; border-radius: 20px; padding: 8px 16px; margin: 5px; display: inline-block; }
        .comment-item { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 20px; margin-bottom: 15px; }
        .star { font-size: 1.8rem; cursor: pointer; color: #444; }
        .star:hover, .star.selected { color: #ffcc00; }
        
        /* Уведомления */
        .toast-message {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(26, 26, 26, 0.95);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 10000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border-left: 4px solid #28a745;
            max-width: 300px;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="text-white">
    <div class="backdrop" id="backdrop"></div>

    <nav class="navbar navbar-dark py-3 border-bottom border-secondary main-header">
        <div class="container-fluid">
            <a href="index.html" class="btn btn-outline-danger">← Back to Home</a>
            <button class="btn btn-danger" id="openAccessModal">Sign In</button>
        </div>
    </nav>

    <div class="container py-5">
        <div id="movie-details" class="bg-dark p-4 rounded"></div>

        <div class="trailer-container mt-5 bg-dark p-4 rounded">
            <h3 class="text-danger mb-3"><i class="fas fa-play"></i> Trailer</h3>
            <div class="ratio ratio-16x9">
                <iframe id="trailerVideo" src="" frameborder="0" allowfullscreen></iframe>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-lg-8">
                <div class="comments-section bg-dark p-4 rounded">
                    <h3 class="text-danger mb-4"><i class="fas fa-comments"></i> Comments</h3>
                    
                    <div class="comment-form mb-4 p-3 bg-black rounded">
                        <textarea id="commentText" class="form-control bg-dark text-white mb-2" rows="3" placeholder="Write your comment..."></textarea>
                        <button id="submitComment" class="btn btn-danger w-100">Post Comment</button>
                    </div>
                    
                    <div id="commentsList">
                        <p class="text-center text-muted">Loading comments...</p>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="bg-dark p-4 rounded mb-4">
                    <h4 class="text-danger mb-3"><i class="fas fa-star"></i> Rate this movie</h4>
                    <div class="rating-stars">
                        <i class="far fa-star star" data-rating="1"></i>
                        <i class="far fa-star star" data-rating="2"></i>
                        <i class="far fa-star star" data-rating="3"></i>
                        <i class="far fa-star star" data-rating="4"></i>
                        <i class="far fa-star star" data-rating="5"></i>
                    </div>
                    <div class="mt-2 text-muted small" id="ratingStatus"></div>
                </div>
                
                <div class="bg-dark p-4 rounded">
                    <h4 class="text-danger mb-3"><i class="fas fa-film"></i> Similar Movies</h4>
                    <div id="similarMovies">
                        <p class="text-muted">Similar movies will appear here</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно входа -->
    <div id="accessModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="modalAccessTitle">Sign In to MyFlix</h3>
            <div class="form-wrapper" id="loginPanel">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="logEmail">Email:</label>
                        <input type="email" id="logEmail" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="logPassword">Password:</label>
                        <input type="password" id="logPassword" class="form-control" />
                    </div>
                    <button type="submit" class="btn btn-danger w-100 mt-3">Sign In</button>
                    <div class="success-message mt-2" id="logSuccessMessage"></div>
                </form>
                <p class="switch-link mt-3 text-center">
                    Don't have an account? <a href="#" id="showRegister" class="text-danger">Register</a>
                </p>
            </div>
            <div class="form-wrapper" id="registerPanel" style="display: none;">
                <form id="registrationForm">
                    <div class="form-group">
                        <label for="regName">Name:</label>
                        <input type="text" id="regName" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="regEmail">Email:</label>
                        <input type="email" id="regEmail" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="regPassword">Password:</label>
                        <input type="password" id="regPassword" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="regConfirmPassword">Confirm Password:</label>
                        <input type="password" id="regConfirmPassword" class="form-control" />
                    </div>
                    <button type="submit" class="btn btn-danger w-100 mt-3">Register</button>
                    <div class="success-message mt-2" id="regSuccessMessage"></div>
                </form>
                <p class="switch-link mt-3 text-center">
                    Already have an account? <a href="#" id="showLogin" class="text-danger">Sign In</a>
                </p>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Функция для показа уведомлений
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast-message';
            toast.textContent = message;
            
            if (type === 'error') {
                toast.style.borderLeftColor = '#ff4444';
            } else if (type === 'info') {
                toast.style.borderLeftColor = '#17a2b8';
            }
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Данные фильмов
        const movieDatabase = {
            1: { title: "28 Years Later", year: 2024, genre: ["Action", "Drama"], director: "Danny Boyle",
                actors: ["Cillian Murphy", "Naomie Harris"], description: "Sequel to the acclaimed zombie film.",
                posterUrl: "images/28years.jpg", trailerUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ", rating: 4.5 },
            2: { title: "Back In Action", year: 2023, genre: ["Comedy", "Action"], director: "Phil Lord",
                actors: ["Jamie Foxx", "Cameron Diaz"], description: "A retired spy returns to action.",
                posterUrl: "images/backinaction.jpg", trailerUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ", rating: 4.2 },
            3: { title: "F1", year: 2023, genre: ["Sports", "Drama"], director: "Joseph Kosinski",
                actors: ["Brad Pitt", "Damson Idris"], description: "Veteran F1 driver mentors a rookie.",
                posterUrl: "images/f1.jpg", trailerUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ", rating: 4.3 },
            4: { title: "Journey 2", year: 2022, genre: ["Adventure", "Fantasy"], director: "Brad Peyton",
                actors: ["Dwayne Johnson", "Karen Gillan"], description: "Expedition discovers mysterious island.",
                posterUrl: "images/journey2.jpeg", trailerUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ", rating: 4.0 },
            5: { title: "Materialists", year: 2023, genre: ["Drama", "Romance"], director: "Celine Song",
                actors: ["Pedro Pascal", "Chris Evans"], description: "Love triangle about materialism.",
                posterUrl: "images/materialists.jpeg", trailerUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ", rating: 4.1 },
            6: { title: "The Pickup", year: 2023, genre: ["Comedy", "Romance"], director: "Emma Seligman",
                actors: ["Geraldine Viswanathan", "D'Pharaoh"], description: "Wrong suitcase leads to romance.",
                posterUrl: "images/thepickup.jpg", trailerUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ", rating: 3.9 },
            7: { title: "The Magnificent Seven", year: 2024, genre: ["Western", "Action"], director: "Antoine Fuqua",
                actors: ["Denzel Washington", "Chris Pratt"], description: "Seven gunmen protect a town.",
                posterUrl: "images/magnseven.jpg", trailerUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ", rating: 4.4 },
            8: { title: "Steve", year: 2023, genre: ["Biography", "Drama"], director: "Michele D'Aquila",
                actors: ["Michael Fassbender", "Kate Winslet"], description: "True story of Steve.",
                posterUrl: "images/steve.jpg", trailerUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ", rating: 4.6 },
            9: { title: "The Tomorrow War", year: 2023, genre: ["Sci-Fi", "Action"], director: "Chris McKay",
                actors: ["Chris Pratt", "Yvonne Strahovski"], description: "Fight in a future war.",
                posterUrl: "images/thetomorrowwar.webp", trailerUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ", rating: 4.2 },
            10: { title: "The Woman", year: 2023, genre: ["Horror", "Thriller"], director: "Lucky McKee",
                actors: ["Pollyanna McIntosh", "Sean Bridgers"], description: "Feral woman unleashes secrets.",
                posterUrl: "images/thewoman.jpg", trailerUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ", rating: 4.0 },
            11: { title: "War of the Worlds", year: 2023, genre: ["Sci-Fi", "Action"], director: "Steven Spielberg",
                actors: ["Tom Cruise", "Dakota Fanning"], description: "Alien invasion threatens humanity.",
                posterUrl: "images/waroftheworls.jpg", trailerUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ", rating: 4.3 }
        };

        // Получение ID из URL
        function getMovieId() {
            const params = new URLSearchParams(window.location.search);
            return params.get('staticId') || '1';
        }

        // Загрузка фильма
        function loadMovie() {
            const movieId = getMovieId();
            const movie = movieDatabase[movieId];
            
            if (!movie) {
                document.getElementById('movie-details').innerHTML = '<h3 class="text-danger">Movie not found</h3>';
                return;
            }
            
            document.getElementById('backdrop').style.backgroundImage = `url('${movie.posterUrl}')`;
            document.getElementById('trailerVideo').src = movie.trailerUrl;
            
            document.getElementById('movie-details').innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        <img src="${movie.posterUrl}" alt="${movie.title}" class="movie-poster">
                    </div>
                    <div class="col-md-8">
                        <h1 class="text-danger">${movie.title} <span class="text-white">(${movie.year})</span></h1>
                        <p><strong>Director:</strong> ${movie.director}</p>
                        <p><strong>Genre:</strong> ${movie.genre.join(', ')}</p>
                        <p><strong>Rating:</strong> ${movie.rating}/5.0</p>
                        <div class="mt-3">
                            <h5 class="info-title">Cast</h5>
                            <div class="cast-list">${movie.actors.map(a => `<span>${a}</span>`).join('')}</div>
                        </div>
                        <div class="mt-4">
                            <h5 class="info-title">Description</h5>
                            <p>${movie.description}</p>
                        </div>
                        <button class="btn btn-danger mt-3" onclick="playTrailer()">
                            <i class="fas fa-play"></i> Watch Trailer
                        </button>
                        <button class="btn btn-outline-danger mt-3 ms-2" onclick="addToFavorites(${movieId})">
                            <i class="far fa-heart"></i> Add to Favorites
                        </button>
                    </div>
                </div>
            `;
            
            loadComments(movieId);
            loadSimilarMovies(movie.genre[0]);
            setupEventHandlers();
        }

        // Загрузка комментариев
        function loadComments(movieId) {
            let comments = JSON.parse(localStorage.getItem(`comments_${movieId}`) || '[]');
            
            if (comments.length === 0) {
                comments = [
                    { id: 1, user: "MovieLover", text: "Great movie!", date: "2024-01-15" },
                    { id: 2, user: "CinemaFan", text: "Amazing acting!", date: "2024-01-10" }
                ];
            }
            
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            
            document.getElementById('commentsList').innerHTML = comments.length > 0 ? 
                comments.map(comment => `
                    <div class="comment-item">
                        <div class="d-flex justify-content-between">
                            <strong class="text-danger">${comment.user}</strong>
                            <small class="text-muted">${comment.date}</small>
                        </div>
                        <p class="mt-2 mb-0">${comment.text}</p>
                        ${user && comment.user === user.name ? `
                            <div class="mt-2">
                                <button class="btn btn-sm btn-outline-warning" onclick="editComment(${comment.id})">Edit</button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteComment(${comment.id})">Delete</button>
                            </div>
                        ` : ''}
                    </div>
                `).join('') : '<p class="text-center text-muted">No comments yet. Be the first!</p>';
        }

        // Добавление комментария
        document.getElementById('submitComment').addEventListener('click', function() {
            const text = document.getElementById('commentText').value;
            const user = JSON.parse(localStorage.getItem('user'));
            
            if (!user) {
                showToast('Please sign in to comment', 'error');
                document.getElementById('openAccessModal').click();
                return;
            }
            
            if (!text.trim()) {
                showToast('Please write a comment', 'error');
                return;
            }
            
            const movieId = getMovieId();
            let comments = JSON.parse(localStorage.getItem(`comments_${movieId}`) || '[]');
            
            const newComment = {
                id: Date.now(),
                user: user.name,
                text: text,
                date: new Date().toLocaleDateString()
            };
            
            comments.unshift(newComment);
            localStorage.setItem(`comments_${movieId}`, JSON.stringify(comments));
            
            document.getElementById('commentText').value = '';
            loadComments(movieId);
            showToast('Comment added successfully!');
        });

        // Удаление комментария
        function deleteComment(commentId) {
            const movieId = getMovieId();
            let comments = JSON.parse(localStorage.getItem(`comments_${movieId}`) || '[]');
            comments = comments.filter(c => c.id !== commentId);
            localStorage.setItem(`comments_${movieId}`, JSON.stringify(comments));
            loadComments(movieId);
            showToast('Comment deleted');
        }

        // Редактирование комментария
        function editComment(commentId) {
            const movieId = getMovieId();
            let comments = JSON.parse(localStorage.getItem(`comments_${movieId}`) || '[]');
            const comment = comments.find(c => c.id === commentId);
            
            const newText = prompt('Edit your comment:', comment.text);
            if (newText !== null) {
                comment.text = newText;
                localStorage.setItem(`comments_${movieId}`, JSON.stringify(comments));
                loadComments(movieId);
                showToast('Comment updated');
            }
        }

        // Похожие фильмы
        function loadSimilarMovies(genre) {
            const similar = Object.entries(movieDatabase)
                .filter(([id, movie]) => movie.genre.includes(genre) && id !== getMovieId())
                .slice(0, 3);
            
            document.getElementById('similarMovies').innerHTML = similar.length > 0 ? 
                similar.map(([id, movie]) => `
                    <a href="movie-details.html?staticId=${id}" class="d-block text-decoration-none mb-2">
                        <div class="bg-black p-2 rounded">
                            <strong class="text-white">${movie.title}</strong>
                            <small class="text-muted d-block">${movie.year} • ${movie.genre[0]}</small>
                        </div>
                    </a>
                `).join('') : '<p class="text-muted">No similar movies found</p>';
        }

        // Рейтинг
        function setupEventHandlers() {
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    const rating = this.dataset.rating;
                    const user = JSON.parse(localStorage.getItem('user'));
                    
                    if (!user) {
                        showToast('Please sign in to rate', 'error');
                        return;
                    }
                    
                    document.querySelectorAll('.star').forEach(s => {
                        if (s.dataset.rating <= rating) {
                            s.classList.remove('far');
                            s.classList.add('fas', 'selected');
                        } else {
                            s.classList.remove('fas', 'selected');
                            s.classList.add('far');
                        }
                    });
                    
                    localStorage.setItem(`rating_${getMovieId()}_${user.id}`, rating);
                    document.getElementById('ratingStatus').textContent = `You rated ${rating} stars`;
                    showToast(`Rated ${rating} stars!`);
                });
            });
        }

        // Избранное
        function addToFavorites(movieId) {
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user) {
                showToast('Please sign in to add favorites', 'error');
                return;
            }
            
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            if (!favorites.includes(movieId)) {
                favorites.push(movieId);
                localStorage.setItem('favorites', JSON.stringify(favorites));
                showToast('Added to favorites!');
            } else {
                showToast('Already in favorites', 'info');
            }
        }

        // Трейлер
        function playTrailer() {
            document.querySelector('.trailer-container').scrollIntoView({ behavior: 'smooth' });
            showToast('Playing trailer...', 'info');
        }

        // Авторизация
        document.addEventListener('DOMContentLoaded', function() {
            loadMovie();
            
            const user = JSON.parse(localStorage.getItem('user'));
            if (user) {
                document.getElementById('openAccessModal').textContent = user.name;
                document.getElementById('openAccessModal').classList.remove('btn-danger');
                document.getElementById('openAccessModal').classList.add('btn-success');
            }
            
            const modal = document.getElementById('accessModal');
            const closeBtn = modal.querySelector('.close-button');
            const openBtn = document.getElementById('openAccessModal');
            
            openBtn.addEventListener('click', function() {
                if (user) {
                    showToast(`Welcome ${user.name}!`, 'info');
                    return;
                }
                modal.style.display = 'flex';
            });
            
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            window.addEventListener('click', function(e) {
                if (e.target === modal) modal.style.display = 'none';
            });
        });
    </script>
</body>
</html>